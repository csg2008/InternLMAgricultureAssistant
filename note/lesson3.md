# 茴香豆：搭建你的 RAG 智能助理

## 一、RAG 概述
### A、RAG 是什么？
RAG(Retrieval Augmented Generation)是一种结合了信息检索(Retrieval)和自然语言生成(Generation)的技术,旨在通过利用外部知识库来增强大型语言模型(LLMs)的性能。其核心原理在于利用检索模型从大量的语料库中搜索与输入查询相关的文本片段，并结合这些信息来生成更准确、更丰富的回答。

### B、RAG 解决的问题
> - 解决大模型短板, 如: 知识时效性受限更新成本高、专业能力有限容易产生幻觉、定制化成本高、缺乏透明可追溯的推理过程
> - 扩展大模型能力，如：通过引入外部知识库使得模型能够访问更广泛的知识，扩展其生成能力以生成更准确、更具体的回答，特别是在处理复杂或专业性的问题时，避免可能会生成一些与事实不符或误导性的内容从而减少了编造内容的风险。

### C、应用场景
> - 内容生成：在内容创作领域，RAG技术能够利用检索到的信息来生成包含特定事实和细节的内容。这使得生成的内容更加丰富、可靠，并有助于提高内容的质量和原创性。

> - 数据增强：在训练其他自然语言处理（NLP）模型时，RAG可以用来生成新的训练样本。通过提供额外的上下文信息和相关事实，RAG可以增强模型的性能，提高其在各种任务上的准确性和泛化能力。

> - 智能客服与问答系统：在智能客服和问答系统中，RAG可以帮助机器人或虚拟助手更准确地理解用户的问题，可以动态地从外部知识库中检索与问题相关的信息，并基于这些信息生成自然、流畅且符合用户需求的对话内容，提升用户体验。

> - 知识库智能检索：RAG技术可以应用于知识库智能检索场景，提供更准确的搜索结果和回答。传统的关键词匹配方法可能无法捕捉到查询的深层含义，而RAG技术可以通过理解知识库中的语义关系来检索与查询语义相关的信息，从而提供更加智能化和人性化的检索体验。

## 二、RAG 技术原理
### A、基本工作流程
![](./asset/15.png)

### B、技术名词释义
> - 向量数据库(Vector-DB)：简单来说，向量数据库就是一个特殊的“大仓库”，里面有很多不同的玩具，每个玩具都有自己独特的形状和颜色。不同的玩具就像里面存储的数据项，但是每个数据项被表示为一个具有很多数字的“标签”。这些数字就像玩具的独特特征，描述了数据项的各种属性。有了这个特殊的仓库，当你需要找到和某个数据项（玩具）最相似的其他数据项时，向量数据库会帮助你快速找到这些相似的数据项。
> - 文档与知识库(Knowledge)：比如工作报告、学习笔记、产品介绍、新闻、合同协议等，都是常见的文档类型。集合了大量特定领域内容的文档就是知识库，知识库里的知识和信息通常是经过精心筛选和整理的，当我们有问题或者需要了解某个知识点时，我们就可以向这个知识库求助，它会快速地给我们返回相关的答案或解释。
> - 检索器(Retrieval)：检索器就像一个智能的查找小助手，当你有问题或者想知道某些信息时，可以向这个小助手提问，它会迅速帮你从知识库中找到最相关、最准确的信息。
> - 索引(Indexing)：将知识库中的文档编码为向量并存储到向量数据库中的过程
> - 生成(Generation): 将检索到的文档片段与原始问题一起作为提示词(prompt)输入到大模型中并生成最终回答的过程

### C、向量数据库
> - 数据存储：将拆分为块的文档片段基于预训练的词嵌入模型转换为固定长度的向量表示后存储到向量数据库中。当前课程用的词嵌入模型是 bce-embedding-base_v1, 更多模型可以参见 [Massive Text Embedding Benchmark (MTEB) Leaderboard](https://huggingface.co/spaces/mteb/leaderboard)
> - 相似性检索: 从向量数据库中检索跟查询问题最相似的文档片段过程, 是实现快速准确回答问题的基础。常用的相似性检索算法：[余弦相似度](https://zh.wikipedia.org/wiki/%E4%BD%99%E5%BC%A6%E7%9B%B8%E4%BC%BC%E6%80%A7)、[点积](https://zh.wikipedia.org/wiki/%E7%82%B9%E7%A7%AF)、[欧氏距离](https://zh.wikipedia.org/wiki/%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB)


### D、RAG 发展阶段
> - 基础(Naive RAG): 由索引、检索、生成构成的最基础的 RAG 应用，通常应用于信息检索场景
> - 进阶(Advanced RAG): 在基础阶段上加入数据索引、检索前和检索后的各个步骤进行优化以提升效果，通常应用于摘要生成
> - 模块化(Modular RAG): 在进阶阶段基础上对各个环节都模块化，可以根据实际业务场景定制，通常应用于多模态任务与问答系统

### E、RAG 与微调整对比
![](./asset/16.png)

## 三、茴香豆技术讲解
### A、介绍
茴香豆是由书生浦语开发的开源大模型知识助手应用。主要优势：
> - 成本低至 1.5G 显存，无需训练适用各行业
> - 提供一整套前后端 web、android、算法源码，工业级开源可商用
> - 设计拒答、响应两阶段 pipeline 应对群聊场景，解答问题同时不会消息泛滥
> - 通过应用 RAG 技术，茴香豆能够理解与高效准确的回应与特定知识领域相关的复杂问题

### B、核心特性
![](./asset/17.png)

### C、工作流程
![](./asset/18.png)

## 四、Web 版茴香豆体验
### A、创建知识库并上传文档
![](./asset/19.png)
![](./asset/20.png)

### B、在线体验
![](./asset/21.png)

### C、问答总结分析
> - 对比问题答案与原始文档十个问题：正确六个、错误两个、技术错误两个
> - 两个错误回答中三号问题 `金桔怎么浇水` 回答与问题完全无关，四号问题 `菠萝长在树上还是地上` 直接从问题中取结果没有看后面的答案
> - 两个技术错误，在多次刷新页面重新测试时会出现同一个问有时能正确回答有时就是技术错误，重现概率比较高